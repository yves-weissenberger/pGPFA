this code borrows (heavily) from Hooram Nam's implementation of the same algorithm
